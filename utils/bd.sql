CREATE TABLE MEDICO(
	ID SERIAL NOT NULL PRIMARY KEY,
	NOME VARCHAR(45) NOT NULL,
	CPF VARCHAR(14) NOT NULL,
	DATA_NASCIMENTO DATE NOT NULL,
	SEXO VARCHAR(10) NOT NULL,
	TELEFONE VARCHAR(20) NOT NULL,
	EMAIL VARCHAR(150) NOT NULL,
	LOGRADOURO VARCHAR(45) NOT NULL,
	NUMERO VARCHAR(10) NOT NULL,
	BAIRRO VARCHAR(50) NOT NULL
	);
CREATE TABLE PACIENTE(
	ID SERIAL NOT NULL PRIMARY KEY,
	NOME VARCHAR(45) NOT NULL,
	CPF VARCHAR(14) NOT NULL,
	CARTAO_SUS VARCHAR(20) NOT NULL,
	DATA_NASCIMENTO DATE NOT NULL,
	SEXO VARCHAR(10) NOT NULL,
	TELEFONE VARCHAR(20) NOT NULL,
	EMAIL VARCHAR(150) NOT NULL,
	LOGRADOURO VARCHAR(45) NOT NULL,
	NUMERO VARCHAR(10) NOT NULL,
	BAIRRO VARCHAR(50) NOT NULL
	);
	
CREATE TABLE PROCEDIMENTO(
	ID SERIAL NOT NULL PRIMARY KEY,
	NOME VARCHAR(45) NOT NULL,
	IDADE_MINIMA VARCHAR(3) NOT NULL,
	IDADE_MAXIMA VARCHAR(3) NOT NULL,
	SEXO VARCHAR(10) NOT NULL
	);

CREATE TABLE COD_PROCEDIMENTO(
	ID SERIAL NOT NULL PRIMARY KEY,
	PROCEDIMENTO_ID INT NOT NULL ,
	CODIGO VARCHAR(10) NOT NULL,
	FOREIGN KEY (PROCEDIMENTO_ID) REFERENCES PROCEDIMENTO(ID)
	);

CREATE TABLE CONSULTA(
	ID SERIAL NOT NULL PRIMARY KEY,
	PACIENTE_ID INT NOT NULL,
	MEDICO_ID INT NOT NULL,
	PROCEDIMENTO_ID INT NOT NULL,
	DATA_AGENDAMENTO DATE NOT NULL,
	HORARIO VARCHAR(10) NOT NULL,
        FOREIGN KEY (PACIENTE_ID) REFERENCES PACIENTE(ID),
        FOREIGN KEY (MEDICO_ID) REFERENCES MEDICO(ID),
        FOREIGN KEY (PROCEDIMENTO_ID) REFERENCES PROCEDIMENTO(ID)
	);

CREATE TABLE REGISTRO_ATENDIMENTO(
	ID SERIAL NOT NULL PRIMARY KEY,
	CONSULTA_ID INT NOT NULL,
	SITUACAO INT NOT NULL,
	DATA_EFETIVA DATE NULL,
	HORARIO_EFETIVO VARCHAR(10) NULL,
	OBS VARCHAR(120) NULL,
	FOREIGN KEY (CONSULTA_ID) REFERENCES CONSULTA(ID)
	);

ALTER TABLE paciente DROP COLUMN telefone;
ALTER TABLE PACIENTE ADD COLUMN TELEFONE VARCHAR(20);

ALTER TABLE paciente DROP COLUMN email;
ALTER TABLE PACIENTE ADD COLUMN EMAIL VARCHAR(50);

select * from procedimento

SELECT *,CON.ID AS ID FROM CONSULTA AS CON JOIN REGISTRO_ATENDIMENTO AS RA ON CON.ID = RA.CONSULTA_ID
select * from registro_atendimento

INSERT INTO PROCEDIMENTO VALUES (1,'CONSULTA MEDICA - DERMATOLOGISTA','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (2,'CONSULTA MEDICA - PEDIATRA','0','15','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (3,'CONSULTA MEDICA - CARDIOLOGISTA','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (4,'CONSULTA MEDICA - GINECOLOGISTA','12','130','FEMININO');
INSERT INTO PROCEDIMENTO VALUES (5,'DOSAGEM DE COLESTEROL HDL','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (6,'DOSAGEM DE GLICOSE','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (7,'ELETROCARDIOGRAMA','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (8,'HEMOGRAMA COMPLETO','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (9,'TOMOGRAFIA COMPUTADORIZADA DO CRANIO','0','130','AMBOS');
INSERT INTO PROCEDIMENTO VALUES (10,'ULTRASSONOGRAFIA TRANSVAGINAL','0','130','FEMININO');
INSERT INTO PROCEDIMENTO VALUES (11,'BIOPSIA DE EPIDIDIMO','10','130','MASCULINO');
INSERT INTO PROCEDIMENTO VALUES (12,'BIOPSIA DE PROSTATA','10','130','MASCULINO');
INSERT INTO PROCEDIMENTO VALUES (13,'ULTRASSONOGRAFIA DE ABDOMEN TOTAL','0','130','AMBOS');

INSERT INTO COD_PROCEDIMENTO VALUES (1,1,'0301010071');
INSERT INTO COD_PROCEDIMENTO VALUES (2,2,'0301010073');
INSERT INTO COD_PROCEDIMENTO VALUES (3,3,'0301010075');
INSERT INTO COD_PROCEDIMENTO VALUES (4,4,'0301010076');
INSERT INTO COD_PROCEDIMENTO VALUES (5,5,'0202010011');
INSERT INTO COD_PROCEDIMENTO VALUES (6,6,'0202010012');
INSERT INTO COD_PROCEDIMENTO VALUES (7,7,'0211020036');
INSERT INTO COD_PROCEDIMENTO VALUES (8,8,'0202020380');
INSERT INTO COD_PROCEDIMENTO VALUES (9,9,'0206010079');
INSERT INTO COD_PROCEDIMENTO VALUES (10,10,'0205020186');
INSERT INTO COD_PROCEDIMENTO VALUES (11,11,'0201010178');
INSERT INTO COD_PROCEDIMENTO VALUES (12,12,'0201010410');
INSERT INTO COD_PROCEDIMENTO VALUES (13,13,'0205020046');


DROP TABLE REGISTRO_ATENDIMENTO;
DROP TABLE CONSULTA;
DROP TABLE MEDICO;
DROP TABLE PACIENTE;


INSERT INTO MEDICO VALUES (DEFAULT,
	'REGINALDO SOUSA PERREIRA',
	'95661722060',
	'1989-09-01',
	'masculino',
	'994983839',
	'REGINALDO@GMAIL.COM',
	'RUA DOS BOBOS',
	'0',
	'SOLIMOES'
	);


INSERT INTO MEDICO VALUES (DEFAULT,
	'LUANA DA SILVA CAMPOS',
	'61415836019',
	'1975-02-26',
	'feminino',
	'988374833',
	'LUANA@GMAIL.COM',
	'RUA CANCOES',
	'24',
	'PLANALTO URUGUAI'
	);

INSERT INTO PACIENTE VALUES (DEFAULT,
	'MARCOS FILHO PINHO',
	'30106570056',
	'837497521289373',
	'1999-09-10',
	'masculino',
	'987383933',
	'MARCOS@HOTMAIL.COM',
	'RUA ANTONIO BALSAS',
	'102',
	'MORADA NOVA'
	);

INSERT INTO PACIENTE VALUES (DEFAULT,
	'LUIS RICARDO FERNANDES',
	'68989672074',
	'932974301418103',
	'1975-02-18',
	'masculino',
	'981914507',
	'LUIS_RICARDO@GMAIL.COM',
	'RUA OLAVA BILAC',
	'3334',
	'CENTRO'
	);

INSERT INTO PACIENTE VALUES (DEFAULT,
	'Allana Pietra Luzia Aparício',
	'68989672074',
	'932974301418103',
	'1975-02-18',
	'masculino',
	'981914507',
	'LUIS_RICARDO@GMAIL.COM',
	'RUA OLAVA BILAC',
	'3334',
	'CENTRO'
	);
	
INSERT INTO CONSULTA VALUES (DEFAULT,4,1,2,'2020-05-01','06:00');
INSERT INTO CONSULTA VALUES (DEFAULT,2,1,1,'2020-04-30','10:00');
INSERT INTO CONSULTA VALUES (DEFAULT,5,3,4,'2020-04-23','09:00');
INSERT INTO CONSULTA VALUES (DEFAULT,7,2,5,'2020-02-20','11:00');
INSERT INTO CONSULTA VALUES (DEFAULT,3,2,48,'2020-04-14','06:00');


INSERT INTO REGISTRO_ATENDIMENTO VALUES (DEFAULT,1,1,'2020-05-25','14:00',NULL,'2020-05-10');
INSERT INTO REGISTRO_ATENDIMENTO VALUES (DEFAULT,2,3,NULL,NULL,'O FILHO DO MÉDICO ADOECEU','2020-04-01');

/*CONSULTA*/
SELECT * FROM PROCEDIMENTO PRO JOIN COD_PROCEDIMENTO CD  ON (PRO.ID = CD.PROCEDIMENTO_ID) WHERE PRO.NOME = 'CONSULTA MEDICA - DERMATOLOGISTA';

DELETE FROM paciente WHERE id = 1;
SELECT * FROM CONSULTA WHERE CONSULTA.ID = 37;
SELECT CONSULTA_ID FROM REGISTRO_ATENDIMENTO WHERE REGISTRO_ATENDIMENTO.ID = 13
DELETE FROM CONSULTA WHERE CONSULTA.ID = (SELECT CONSULTA_ID FROM REGISTRO_ATENDIMENTO WHERE REGISTRO_ATENDIMENTO.ID = 13); 
select * from procedimento
SELECT MAX(ID) FROM PROCEDIMENTO
INSERT INTO COD_PROCEDIMENTO VALUES (DEFAULT,'21','6786545643');
INSERT INTO PROCEDIMENTO VALUES (DEFAULT,'Mamografia','0','130','FEMININO');
INSERT INTO COD_PROCEDIMENTO VALUES (14,19,'0205020044');
SELECT MAX(ID) FROM PROCEDIMENTO

DELETE FROM PROCEDIMENTO WHERE ID > 13;
SELECT * FROM paciente WHERE id = 5
SELECT *,CON.ID AS ID FROM CONSULTA AS CON LEFT JOIN REGISTRO_ATENDIMENTO AS RA ON CON.ID = RA.CONSULTA_ID WHERE CONSULTA_ID IS NULL
SELECT * FROM REGISTRO_ATENDIMENTO;
SELECT RA.ID AS RA_ID,P.NOME AS P_NOME,M.NOME AS M_NOME,P.CPF AS P_CPF,M.CPF AS M_CPF,DATA_AGENDAMENTO,HORARIO,DATA_EFETIVA,HORARIO_EFETIVO,OBS,SITUACAO,CARTAO_SUS FROM CONSULTA CON JOIN REGISTRO_ATENDIMENTO RA ON CON.ID = RA.CONSULTA_ID JOIN PACIENTE P ON CON.PACIENTE_ID = P.ID JOIN MEDICO M ON M.ID = CON.MEDICO_ID
SELECT RA.ID AS RA_ID,CON.ID AS CON_ID, P.NOME AS P_NOME,M.NOME AS M_NOME,P.CPF AS P_CPF,M.CPF AS M_CPF,DATA_AGENDAMENTO,DATA_EFETIVA,OBS,SITUACAO,CARTAO_SUS,HORARIO_EFETIVO,HORARIO FROM CONSULTA CON JOIN REGISTRO_ATENDIMENTO RA ON CON.ID = RA.CONSULTA_ID JOIN PACIENTE P ON CON.PACIENTE_ID = P.ID JOIN MEDICO M ON M.ID = CON.MEDICO_ID

SELECT *,CON.ID AS ID FROM CONSULTA AS CON LEFT JOIN REGISTRO_ATENDIMENTO AS RA ON CON.ID = RA.CONSULTA_ID WHERE  CON.ID = 48 AND CONSULTA_ID IS NULL
 